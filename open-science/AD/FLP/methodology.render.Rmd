---
title: Open methodology for "Exact approach for convex adjustable robust optimization" > Facility Location Problem (FLP)
output: 
  html_document:
    theme: null
    css: /assets/css/design.css
    self_contained: false
    highlight: null
    include:
      in_header: ../../../_includes/head.html
      before_body: 
        - ../../../_includes/header.html
        - ../../../_includes/begin_content.html
        - ../../../_includes/toc.html
        - ../../../_includes/begin_post_content.html
      after_body: 
        - ../../../_includes/handle_page_title.html
        - ../../../_includes/end_post_content.html
        - ../../../_includes/end_content.html
        - ../../../_includes/footer.html
---

<div class="warning">This document is automatically generated after every `git push` action on the public repository `hlefebvr/hlefebvr.github.io` using rmarkdown and Github Actions. This ensures total reproducibility of our data manipulation. Last automatic compilation: `r format(Sys.time(), '%d/%m/%y %H:%M:%S')`.</div>


```{r echo=FALSE}
library(rmarkdown)
library(kableExtra)
library(tidyr)
library(ggplot2)
library(dplyr)
```

```{r}
time_limit = 7200
```

```{r}
results = read.table("./results.csv", header = FALSE, sep = ',')
colnames(results) <- c("tag", "instance", "n_facilities", "n_customers", "Gamma", "deviation", "time_limit", "method", "total_time", "master_time", "separation_time", "best_bound", "iteration_count", "fail")
results$tag = NULL

results$p = results$Gamma / results$n_customers
results$p = ceiling(results$p / .05) * .05

results = results[results$p != .5,]

paged_table(results)
```

```{r}
ggplot(results, aes(x = total_time, color = method)) +
  stat_ecdf(geom = "step") +
  xlab("Total Time") +
  ylab("ECDF") +
  labs(title = "ECDF of Total Time by Method")  +
  scale_x_continuous(breaks = seq(0, max(results$total_time), by = 500), labels = seq(0, max(results$total_time), by = 500)) +
  theme_minimal()

```
```{r}
results_solved = results %>%
  filter(total_time < 7200) %>%
  group_by(method, n_facilities, n_customers, p) %>%
  summarize(
    solved = n(),
    total_time = mean(total_time),
    master_time = mean(master_time),
    separation_time = mean(separation_time),
    solved_iteration_count = mean(iteration_count)
  ) %>%
  ungroup()

results_unsolved <- results %>%
  filter(total_time >= 7200) %>%
  group_by(method, n_facilities, n_customers, p) %>%
  summarize(
    unsolved = n(),
    unsolved_iteration_count = mean(iteration_count)
  ) %>%
  ungroup()

# Merge the two results based on the common columns n_facilities, n_customers, p
final_result <- merge(results_solved, results_unsolved, by = c("method", "n_facilities", "n_customers", "p"), all = TRUE)

# Replace NA values with 0
#final_result[is.na(final_result)] <- 0


knitr::kable(final_result, 
               digits = c(0, 0, 0, 2, 0, 2, 2, 2, 2, 0, 2), 
               col.names = c("Method", "|V_1|", "|V_2|", "p", "Count", "Total", "Master", "Sepatation", "# Iter", "Count", "# Iter"),
               caption = "Summary table"
             ) %>%
      kable_classic() %>%
      add_header_above(c(" " = 4, "Solved instances" = 5, "Unsolved instances" = 2)
)
```

